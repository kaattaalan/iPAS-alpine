<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="iPAS.it - Your Pocket Todo List">

  <title>iPAS - Inspired Pass Allocation System</title>

  <script src="js/pocketbase.umd.js"></script>
  <script src="js/install_pwa.js"></script>
  <script src="js/alpine-framework.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.12.0/dist/cdn.min.js"></script>

  <link rel="stylesheet" href="css/pico.min.css">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <link rel="manifest" href="manifest.json">
</head>

<body>
  <div x-data="lists" class="container">
    <nav>
      <ul>
        <li>
          <h1 @click="selectedList = null" style="margin:0; text-align: center; cursor: pointer">iPAS</h1>
        </li>
      </ul>
      <ul>
        <li><i @click="installPWA()" id="install-prompt" class="bx bx-download bx-md"
            style="cursor: pointer; display: none;"></i>
        </li>
        <li><i @click="requestPermission()" id="notify-prompt" class="bx bxs-bell bx-md"
            style="cursor: pointer; display: block;"></i>
        </li>
        <li><i x-show="!showLogin" @click="logout()" class="bx bx-log-out bx-md" style="cursor: pointer"></i></li>
      </ul>
    </nav>

    <!-- login / signup -->
    <article x-show="showLogin" x-transition>
      <div x-data="{ showSignup: false }">
        <form x-show="!showSignup">
          <h2>Login</h2>
          <label for="email">Email</label>
          <input x-model="email" type="email" id="loginEmail" placeholder="Email address">

          <label for="password">Password</label>
          <input x-model="password" type="password" id="loginPassword" autocomplete="on">

          <button @click.prevent="login()" class="contrast outline">Login</button>
          <mark x-show="loginMessage" class="small" x-text="loginMessage"></mark>

          <button type="button" @click.prevent="showSignup = true">Sign Up</button>
        </form>

        <template x-if="showSignup">
          <div>
            <h2>Signup</h2>

            <form>
              <label for="email">Email</label>
              <input x-model="email" type="email" id="email" placeholder="Email address">

              <label for="password">Password</label>
              <input x-model="password" type="password" id="password">

              <label for="passwordConfirm">Confirm Password</label>
              <input x-model="passwordConfirm" type="password" id="passwordConfirm">

              <a href="#" @click.prevent="signup()" class="contrast outline" role="button">Signup</a>
              <a href="#" @click.prevent="showSignup = false" role="button">Login</a>

            </form>

            <mark x-show="signupMessage" class="small" x-text="signupMessage"></mark>
          </div>
        </template>
      </div>
    </article>

    <!-- show user page -->
    <article x-show="!showLogin && userDay" x-data="userDay" x-transition>
      <header x-text="client.authStore.baseModel?client.authStore.baseModel.email:''"></header>
      <article aria-busy="true">Waiting for allocation.</article>
      <!-- toggle days -->
      <details>
        <summary role="button" class="secondary">Days</summary>
        <template x-for="(value, key) in userDay.selected_days" :key="key">
          <div role="button" :class="{ outline: !value }" x-text="key"
            x-on:click="userDay.selected_days[key] = !userDay.selected_days[key]; toggleDays(userDay)" href="#"></div>
        </template>
      </details>
      <!-- Request Pass button -->
      <div x-data="{modal_show : false}">
        <footer dir="rtl">
          <a role="button" class="contrast" @click="modal_show = true" href="#">Request Pass</a>
        </footer>
        <dialog :open="modal_show">
          <article>
            <p>
              You are requesting pass for <strong x-text="modal_show"></strong>
            </p>
            <footer>
              <a href="#cancel" role="button" class="secondary" @click="modal_show = false">Cancel</a>
              <a href="#confirm" role="button">Confirm</a>
            </footer>
          </article>
        </dialog>
      </div>
    </article>

  </div>

</body>

</html>